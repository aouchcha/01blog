<div class="single-post-container">
    <div class="post-wrapper">
        <!-- Back to Home Button -->
        <button class="back-button" *ngIf="me.role !== 'Admin'" (click)="Home()">
            <mat-icon>arrow_back</mat-icon>
            Back to Home
        </button>
        <button class="back-button" *ngIf="me.role === 'Admin'" (click)="ToReports()">
            <mat-icon>arrow_back</mat-icon>
            Back to Reports
        </button>

        <!-- Post Card -->
        <div class="post-card">
            <div class="post-header">
                <div class="post-user">
                    <img [src]="'assets/icons/pngtree-outline-user-icon-png-image_5045523.jpg'" alt="User Avatar"
                        class="user-avatar">
                    <div class="user-info">
                        <strong>{{ post.user.username }}</strong>
                        <span class="timestamp">{{ post.createdAt | date:'short' }}</span>
                    </div>
                </div>

                <button mat-icon-button [matMenuTriggerFor]="optionsMenu" matTooltip="Options"
                    *ngIf="post.user.username === me.username" class="options-btn">
                    <mat-icon>more_vert</mat-icon>
                </button>
                <mat-menu #optionsMenu="matMenu">
                    <button mat-menu-item (click)="ShowUpdate()">
                        <mat-icon>edit</mat-icon>
                        <span>Update</span>
                    </button>
                    <button mat-menu-item (click)="CheckConfirmation()">
                        <mat-icon>delete</mat-icon>
                        <span>Delete</span>
                    </button>
                </mat-menu>
                <div class="post-admin-options" *ngIf="me.role === 'Admin'">
                    <button class="delete-btn" (click)="CheckConfirmation()">
                        <mat-icon>delete</mat-icon>
                    </button>
                    <button class="hide-btn" *ngIf="!post.isHidden" (click)="CheckBeforeHide()">
                        <mat-icon>visibility_off</mat-icon>
                    </button>
                    <button class="hide-btn" *ngIf="post.isHidden" (click)="CheckBeforeUnHide()">
                        <mat-icon>visibility</mat-icon>
                    </button>
                </div>
            </div>

            <div class="post-content">
                <h2>{{ post.title }}</h2>
                <div class="post-media-container" *ngIf="!post.mediaUrl?.endsWith('null')">
                    <ng-container [ngSwitch]="post.mediaUrl ? post.mediaUrl.split('.').pop()?.toLowerCase() : ''">
                        <img *ngSwitchCase="'jpg'" [src]="post.mediaUrl" alt="Post image" class="post-media">
                        <img *ngSwitchCase="'jpeg'" [src]="post.mediaUrl" alt="Post image" class="post-media">
                        <img *ngSwitchCase="'png'" [src]="post.mediaUrl" alt="Post image" class="post-media">
                        <img *ngSwitchCase="'webp'" [src]="post.mediaUrl" alt="Post image" class="post-media">
                        <video *ngSwitchCase="'mp4'" [src]="post.mediaUrl" controls class="post-media"
                            preload="metadata"></video>
                    </ng-container>
                </div>
                <p>{{ post.description }}</p>
            </div>

            <div class="post-actions" *ngIf="me.role !== 'Admin'">
                <button class="action-btn" (click)="React(post.id)">
                    <mat-icon>favorite</mat-icon> {{ post.likeCount || 0 }}
                </button>
                <button class="action-btn">
                    <mat-icon>comment</mat-icon> {{ post.commentsCount || 0 }}
                </button>
                <button class="action-btn" *ngIf="post.user.username !== me.username"
                    (click)="OpenReportSection(post.id)">
                    <mat-icon>report</mat-icon>
                </button>
            </div>
        </div>

        <!-- Update Post Modal -->
        <div class="modal-overlay" *ngIf="update" (click)="Cancel()">
            <div class="modal-content" (click)="$event.stopPropagation()">
                <div class="modal-header">
                    <h2>Update Post</h2>
                    <button class="modal-close" (click)="Cancel()">✕</button>
                </div>
                <textarea [(ngModel)]="updatedTitle" placeholder="Update your title..." class="modal-textarea"
                    maxlength="255" required></textarea>
                <textarea [(ngModel)]="updatedDescription" placeholder="Update your description..."
                    class="modal-textarea" maxlength="1000" required></textarea>

                <label for="UpdateMedia" class="modal-media-btn">Select Media</label>
                <input type="file" id="UpdateMedia" (change)="setMedia($event)" class="media-input"
                    accept="image/*, video/*">
                <div class="media-preview" *ngIf="updatePreviewUrl">
                    <button class="close-btn" (click)="RemoveImage()">✕</button>

                    <img *ngIf="updateIsImage" [src]="updatePreviewUrl" class="preview-img">
                    <video *ngIf="updateIsVideo" [src]="updatePreviewUrl" class="preview-video" controls></video>

                    <p><b>{{ updatedMediaName }}</b></p>
                </div>
                <div class="modal-actions">
                    <button class="modal-save-btn" (click)="UpdatePost()">Save</button>
                    <button class="modal-cancel-btn" (click)="Cancel()">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Comments Section -->
        <div class="comments-section">
            <h2 class="comments-title">Comments</h2>

            <!-- Add Comment -->
            <div class="add-comment-card">
                <img src="../../assets/icons/pngtree-outline-user-icon-png-image_5045523.jpg" alt="Your Avatar"
                    class="comment-avatar">
                <div class="comment-input-wrapper">
                    <textarea [(ngModel)]="content" placeholder="Write a comment..." class="comment-textarea"
                        maxlength="100" required></textarea>
                    <button class="comment-submit-btn" (click)="Comment()">
                        <mat-icon>send</mat-icon>
                        Comment
                    </button>
                </div>
            </div>

            <!-- Comments List -->
            <div class="comments-list">
                <div class="comment-item" *ngFor="let c of comments">
                    <img [src]="'assets/icons/pngtree-outline-user-icon-png-image_5045523.jpg'" alt="User Avatar"
                        class="comment-avatar">
                    <div class="comment-content">
                        <div class="comment-header">
                            <strong>{{ c.user.username }}</strong>
                            <span class="comment-timestamp">{{ c.createdAt | date:'short' }}</span>
                            <button mat-icon-button [matMenuTriggerFor]="optionsMenu" matTooltip="Options"
                                *ngIf="c.user.username === me.username" class="options-btn">
                                <mat-icon>more_vert</mat-icon>
                            </button>
                            <mat-menu #optionsMenu="matMenu">
                                <!-- <button mat-menu-item (click)="updateComment(comment)">
                                    <mat-icon>edit</mat-icon>
                                    <span>Update</span>
                                </button> -->
                                <button mat-menu-item (click)="ConfirmCommentDelet(c.id)">
                                    <mat-icon>delete</mat-icon>
                                    <span>Delete</span>
                                </button>
                            </mat-menu>
                        </div>
                        <p class="comment-text">{{ c.content }}</p>
                    </div>
                </div>

                <div class="empty-comments" *ngIf="!comments || comments.length === 0">
                    <p>No comments yet. Be the first to comment!</p>
                </div>
            </div>
        </div>
        <div class="modal-overlay" *ngIf="showConfirmation" (click)="CancelAction()">
            <app-confirmation [title]="confirmationTitle" [message]="confirmationMessage" [action]="confirmationAction"
                (confirmed)="HandleAction($event)"> </app-confirmation>
        </div>
        <div class="modal-overlay" *ngIf="DoYouWantReport">
            <div class="report-card">
                <h3>Report Post</h3>
                <div class="form-group">
                    <textarea [(ngModel)]="Report_Description" required class="report-textarea"
                        placeholder="Describe the issue..." maxlength="500" aria-required="true"></textarea>
                </div>
                <div class="report-actions">
                    <button class="action-btn primary-btn" (click)="CheckBeforeReport()">
                        Submit Report
                    </button>
                    <button class="action-btn secondary-btn" (click)="Cancel()">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>