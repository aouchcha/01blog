<div class="home-container">
    <!-- Mobile Header -->
    <header class="mobile-header">
        <button class="mobile-menu-btn" (click)="toggleLeftMenu()">
            <mat-icon>menu</mat-icon>
        </button>
        <div class="mobile-logo">
            <div class="logo-icon"></div>
            <span>O1Blog</span>
        </div>
        <button class="mobile-menu-btn" (click)="toggleRightMenu()">

            <mat-icon>person</mat-icon>
        </button>
    </header>

    <!-- Mobile Overlay -->
    <div class="mobile-overlay" *ngIf="leftMenuOpen || rightMenuOpen" (click)="closeMenus()"></div>

    <!-- Left Sidebar - Navigation -->
    <aside class="left-sidebar" [class.mobile-open]="leftMenuOpen">
        <div class="user-info">
            <img src="../../assets/icons/pngtree-outline-user-icon-png-image_5045523.jpg" alt="avatar"
                class="user-avatar" (click)="ToProfile(me.username)">
            <p class="username">{{me.username}}</p>
        </div>

        <nav class="nav-menu">
            <button class="nav-button" (click)="getAllPosts('feed')">
                <mat-icon>feed</mat-icon>Feed
            </button>



            <button class="nav-button" (click)="getNotif()">

                <mat-icon>notifications</mat-icon>
                <span>Notification</span>
                <span class="notification-badge" *ngIf="notifsCount > 0">{{notifsCount}}</span>
            </button>

            <button class="nav-button" (click)="ToProfile(me.username)">

                <mat-icon>person</mat-icon>
                <span>Profile</span>
            </button>
        </nav>
    </aside>

    <!-- Main Content - Feed -->
    <main class="main-content">
        <!-- Notifications Panel -->
        <div class="notifications-panel" *ngIf="ShowNotifs" (scroll)="handleScrollLogic($event, 'notifs')">
            <div class="panel-header">
                <h2>Notifications</h2>
                <button class="close-btn" (click)="CloseNotif()">✕</button>
            </div>
            <div class="empty-state" *ngIf="!Notifs || Notifs.length === 0">
                <p>No notifications yet.</p>
            </div>
            <div class="notifications-list" *ngFor="let notif of Notifs">

                <div class="notification-item">
                    <div class="notification-content">
                        <strong>{{notif.creator.username}}</strong>
                        <span class="notification-text">Created Post At {{notif.createdAt | date:'short'}}</span>
                    </div>
                    <button class="seen-btn" (click)="MarkNotifsAsRead(notif.id)">{{ notif.seen ? 'Seen' :
                        'See'}}</button>
                </div>

            </div>
        </div>

        <!-- Create Post Card -->
        <div class="create-post-card" *ngIf="!ShowNotifs">
            <div class="create-post-header">
                <img src="../../assets/icons/pngtree-outline-user-icon-png-image_5045523.jpg" alt="avatar"
                    class="post-avatar">
                <div class="areas">

                    <textarea [(ngModel)]="title" placeholder="Write Blog Title..." class="post-textarea"
                        id="title"></textarea>

                    <textarea [(ngModel)]="description" placeholder="Write Blog Description..."
                        class="post-textarea"></textarea>
                </div>
            </div>

            <div class="media-preview" *ngIf="previewUrl">
                <button class="close-btn" (click)="RemoveImage('create')">✕</button>

                <img *ngIf="isImage" [src]="previewUrl" class="preview-img">
                <video *ngIf="isVideo" [src]="previewUrl" class="preview-video" controls></video>

                <p><b>{{ mediaName }}</b></p>
            </div>


            <div class="create-post-actions">
                <label for="Media" class="media-btn">
                    <mat-icon>perm_media</mat-icon>
                    Select Media
                </label>
                <input type="file" id="Media" (change)="setMedia($event, 'create')" class="media-input"
                    accept="image/*, video/*">
                <button class="share-btn" (click)="CreatePost()">Share</button>
                <button class="cancel-btn" (click)="Cancel()">Cancel</button>
            </div>
        </div>

        <!-- Posts Feed -->
        <div class="posts-container" *ngIf="!ShowNotifs" (scroll)="handleScrollLogic($event, 'posts')">
            <div class="empty-state" *ngIf="!posts || posts.length === 0">
                <p>No posts yet.</p>
            </div>

            <div class="post-card" *ngFor="let post of posts">
                <div class="post-header">
                    <div class="post-user">
                        <img [src]="'assets/icons/pngtree-outline-user-icon-png-image_5045523.jpg'" alt="User Avatar"
                            class="post-avatar" (click)="ToProfile(post.user.username)">
                        <div class="post-user-info">
                            <strong>{{ post.user.username }}</strong>
                            <span class="post-timestamp">{{ post.createdAt | date:'short' }}</span>
                        </div>
                    </div>

                    <button mat-icon-button [matMenuTriggerFor]="optionsMenu" matTooltip="Options"
                        *ngIf="post.user.username === me.username" class="options-btn">
                        <mat-icon>more_vert</mat-icon>
                    </button>
                    <mat-menu #optionsMenu="matMenu">
                        <button mat-menu-item (click)="ShowUpdate(post.id)">
                            <mat-icon>edit</mat-icon>
                            <span>Update</span>
                        </button>
                        <button mat-menu-item (click)="CheckConfirmation(post.id)">
                            <mat-icon>delete</mat-icon>
                            <span>Delete</span>
                        </button>
                    </mat-menu>
                </div>

                <div class="post-content">
                    <h2>{{ post.title }}</h2>
                    <div class="post-media-container" *ngIf="post.media">
                        <ng-container [ngSwitch]="post.mediaUrl?.split('.').pop()">
                            <img *ngSwitchCase="'jpg'" [src]="post.mediaUrl" alt="Post image" class="post-media">
                            <img *ngSwitchCase="'JPG'" [src]="post.mediaUrl" alt="Post image" class="post-media">
                            <img *ngSwitchCase="'jpeg'" [src]="post.mediaUrl" alt="Post image" class="post-media">
                            <img *ngSwitchCase="'png'" [src]="post.mediaUrl" alt="Post image" class="post-media">
                            <img *ngSwitchCase="'webp'" [src]="post.mediaUrl" alt="Post image" class="post-media">
                            <video *ngSwitchCase="'mp4'" [src]="post.mediaUrl" controls class="post-media"
                                preload="metadata"></video>
                        </ng-container>
                    </div>
                </div>

                <div class="post-actions">
                    <button class="action-btn" (click)="React(post.id)">
                        <mat-icon>favorite</mat-icon> {{ post.likeCount || 0 }}
                    </button>
                    <button class="action-btn" (click)="ShowSinglePost(post.id)">
                        <mat-icon>comment</mat-icon>
                        {{ post.commentsCount || 0 }}
                    </button>
                    <button class="action-btn" *ngIf="post.user.username !== me.username"
                        (click)="OpenReportSection(post.id)">
                        <mat-icon>report</mat-icon>
                    </button>
                </div>
            </div>
        </div>

        <!-- Update Post Modal -->
        <div class="modal-overlay" *ngIf="update" (click)="Cancel()">
            <div class="modal-content" (click)="$event.stopPropagation()">
                <div class="modal-header">
                    <h2>Update Post</h2>
                    <button class="modal-close" (click)="Cancel()">✕</button>
                </div>
                <textarea [(ngModel)]="updatedTitle" placeholder="Update your title..."
                    class="modal-textarea"></textarea>
                <textarea [(ngModel)]="updatedDescription" placeholder="Update your description..."
                    class="modal-textarea"></textarea>

                <label for="UpdateMedia" class="modal-media-btn">Select Media</label>
                <input type="file" id="UpdateMedia" (change)="setMedia($event, 'update')" class="media-input"
                    accept="image/*, video/*">
                <!-- ///////////////////////////////////////////////////////////////// -->
                <div class="media-preview" *ngIf="updatePreviewUrl">
                    <button class="close-btn" (click)="RemoveImage('edit')">✕</button>

                    <img *ngIf="updateIsImage" [src]="updatePreviewUrl" class="preview-img">
                    <video *ngIf="updateIsVideo" [src]="updatePreviewUrl" class="preview-video" controls></video>

                    <p><b>{{ updatedMediaName }}</b></p>
                </div>
                <!-- ///////////////////////////////////////////////////////////////// -->
                <div class="modal-actions">
                    <button class="modal-save-btn" (click)="UpdatePost()">Save</button>
                    <button class="modal-cancel-btn" (click)="Cancel()">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Confirmation Modal -->
        <div class="modal-overlay" *ngIf="showConfirmation" (click)="CancelAction()">
            <app-confirmation [title]="confirmationTitle" [message]="confirmationMessage" [action]="confirmationAction"
                (confirmed)="HandleAction($event)"> </app-confirmation>
        </div>

        <div class="modal-overlay" *ngIf="DoYouWantReport">
            <div class="report-card">
                <h3>Report Post</h3>
                <div class="form-group">
                    <textarea [(ngModel)]="Report_Description" required class="report-textarea"
                        placeholder="Describe the issue..."></textarea>
                </div>
                <div class="report-actions">
                    <button class="action-btn primary-btn" (click)="CheckBeforeReport()">
                        Submit Report
                    </button>
                    <button class="action-btn secondary-btn" (click)="Cancel()">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Right Sidebar - Suggestions -->
    <aside class="right-sidebar" [class.mobile-open]="rightMenuOpen">
        <div class="sidebar-actions">
            <!-- <button class="action-button" (click)="ToProfile(me.username)">Profile</button> -->
            <button class="action-button logout" (click)="Logout()">Logout</button>
        </div>

        <div class="suggestions-section" *ngIf="others && others.length > 0"
            (scroll)="handleScrollLogic($event, 'users')">
            <h3>Suggestions</h3>
            <div class="suggestion-item" *ngFor="let user of others">
                <p class="suggestion-username" (click)="ToProfile(user.username)">{{user.username}}</p>
                <button class="follow-btn" [class.following]="user.follow" (click)="Follow(user.id)">
                    {{ user.follow ? 'Unfollow' : 'Follow'}}
                </button>
            </div>
        </div>
    </aside>
</div>