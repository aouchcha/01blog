<div class="container">
  <section class="profile-wrap">
    <div class="profile-header">
      <img class="avatar" [src]="'assets/icons/pngtree-outline-user-icon-png-image_5045523.jpg'" alt="Avatar">

      <div class="profile-info">
        <div class="row">
          <h1 class="username">{{ user.username }}</h1>

          <!-- Follow / Unfollow button: show follow if not following -->
          <div>
            <button class="btn btn-edit" *ngIf="user.username !== me.username && me.role !== 'Admin'"
              (click)="Follow()">
              {{ user.follow ? 'Unfollow' : 'Follow' }}
            </button>

            <!-- Edit profile button (only owner) -->
            <button class="btn btn-edit" *ngIf="user.username === me?.username">
              Edit profile
            </button>
            <button class="btn btn-edit" *ngIf="me.role !== 'Admin'" (click)="Home()">
              Home
            </button>
            <button class="btn btn-edit" *ngIf="me.role === 'Admin'" (click)="ToDashBoard()">
              To DashBoard
            </button>
            <button class="btn btn-edit" *ngIf="user.id != me.id && me.role !== 'Admin'" (click)="OpenReportSection()">
              Report
            </button>
            <button class="btn btn-edit" *ngIf="me.role === 'Admin'" (click)="RemoveUser()">
              Remove The User
            </button>
          </div>
        </div>

        <div class="report-card" *ngIf="DoYouWantReport">
          <div class="group">
            <textarea [(ngModel)]="description" required="true" id="report-input" type="text" class="input"></textarea>
            <span class="highlight"></span>
            <span class="bar"></span>
            <label>Name</label>
          </div>
          <button class="btn btn-edit" *ngIf="user.username !== me?.username" (click)="Report()">
            Submit
          </button>
          <button class="btn btn-edit" (click)="Cancel()">
            Cancel
          </button>
        </div>
        <!-- <p class="bio" *ngIf="user.bio">{{ me.bio }}</p> -->

        <div class="stats">
          <div class="stat">
            <strong>{{ posts?.length || 0 }}</strong>
            <span>Posts</span>
          </div>
          <div class="stat">
            <strong>{{followers || 0}}</strong>
            <span>Followers</span>
          </div>
          <div class="stat">
            <strong>{{followings || 0}}</strong>
            <span>Following</span>
          </div>
        </div>

        <div class="meta">
          <span *ngIf="user.email">üìç {{ user.email }}</span>
          <!-- <span *ngIf="user.joinedAt"> ¬∑ Joined {{ user.joinedAt | date:'mediumDate' }}</span> -->
        </div>
      </div>
    </div>
  </section>

  <!-- POSTS GRID -->
  <section class="posts-wrap">
    <div *ngIf="!posts || posts.length === 0" class="empty">
      <p>No posts yet.</p>
    </div>

    <div class="posts-grid" *ngIf="posts && posts.length > 0">
      <article class="post-card" *ngFor="let post of posts">
        <header class="post-card-header">
          <div class="author">
            <img class="avatar-sm" [src]="'assets/icons/pngtree-outline-user-icon-png-image_5045523.jpg'" alt="author">
            <div>
              <strong>{{ post.user.username }}</strong>
              <div class="time">{{ post.createdAt | date:'short' }}</div>
            </div>
            <div class="post-actions">
              <button *ngIf="post.user.username === me?.username || me?.role === 'Admin'" class="icon-btn"
                (click)="deletePost(post.id)">üóë</button>
            </div>
          </div>

          <!-- show edit/delete only for owner -->

        </header>

        <!-- Media (image or video) -->
        <div class="media-area" *ngIf="!post.mediaUrl?.endsWith('null')">
          <ng-container [ngSwitch]="post.mediaUrl ? post.mediaUrl.split('.').pop()?.toLowerCase() : ''">
            <img *ngSwitchCase="'jpg'" [src]="post.mediaUrl" alt="Post image" class="post-media">
            <img *ngSwitchCase="'jpeg'" [src]="post.mediaUrl" alt="Post image" class="post-media">
            <img *ngSwitchCase="'png'" [src]="post.mediaUrl" alt="Post image" class="post-media">
            <video *ngSwitchCase="'mp4'" [src]="post.mediaUrl" controls class="post-media" preload="metadata"></video>
          </ng-container>
        </div>

        <div class="post-body">
          <p class="description">{{ post.description }}</p>

          <div class="post-footer">
            <div class="reactions">
              <button class="reaction">‚ù§Ô∏è {{ post.likeCount || 0 }}</button>
              <button class="reaction comment-btn">üí¨ {{ post.commentsCount || 0 }}</button>
            </div>
          </div>
        </div>
      </article>
    </div>
  </section>
  <!-- POPUP MESSAGE -->
  <div class="popup-overlay" *ngIf="showPopup">
    <div class="popup">
      <h3>Message</h3>
      <p>{{ popupMessage }}</p>
      <button class="btn btn-close" (click)="closePopup()">Close</button>
    </div>
  </div>

</div>