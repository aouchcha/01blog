<div class="profile-container">
  <!-- Profile Header Section -->
  <section class="profile-header-section">
    <div class="profile-header-content">
      <!-- Avatar -->
      <div class="avatar-wrapper">
        <img class="profile-avatar" [src]="'assets/icons/pngtree-outline-user-icon-png-image_5045523.jpg'" alt="Avatar">
      </div>

      <!-- Profile Info -->
      <div class="profile-info-wrapper">
        <div class="profile-top">
          <h1 class="profile-username">{{ user.username }}</h1>

          <!-- Action Buttons -->
          <div class="profile-actions">
            <!-- Follow/Unfollow Button -->
            <button class="action-btn primary-btn" *ngIf="user.username !== me.username && me.role !== 'Admin'"
              (click)="Follow()">
              {{ user.follow ? 'Unfollow' : 'Follow' }}
            </button>

            <!-- Edit Profile Button -->
            <button class="action-btn secondary-btn" *ngIf="user.username === me?.username">
              Edit profile
            </button>

            <!-- Home Button -->
            <button class="action-btn secondary-btn" *ngIf="me.role !== 'Admin'" (click)="Home()">
              Home
            </button>

            <!-- Dashboard Button (Admin) -->
            <button class="action-btn secondary-btn" *ngIf="me.role === 'Admin'" (click)="ToDashBoard()">
              To Dashboard
            </button>

            <!-- Report Button -->
            <button class="action-btn warning-btn" *ngIf="user.id != me.id && me.role !== 'Admin'"
              (click)="OpenReportSection()">
              Report
            </button>

            <!-- Remove User Button (Admin) -->
            <button class="action-btn danger-btn" *ngIf="me.role === 'Admin'" (click)="CheckBeforeRemoving()">
              Remove User
            </button>

             <button class="action-btn danger-btn" *ngIf="me.role === 'Admin'" (click)="CheckBeforeBan()">
              {{ user.isBaned ? 'UnBanned' : 'Ban' }}
            </button>
          </div>
        </div>

        <!-- Report Section -->
        <div class="report-section" *ngIf="DoYouWantReport">
          <div class="report-card">
            <h3>Report User</h3>
            <div class="form-group">
              <textarea [(ngModel)]="description" required class="report-textarea"
                placeholder="Describe the issue..."></textarea>
            </div>
            <div class="report-actions">
              <button class="action-btn primary-btn" (click)="CheckReport()">
                Submit Report
              </button>
              <button class="action-btn secondary-btn" (click)="Cancel()">
                Cancel
              </button>
            </div>
          </div>
        </div>

        <!-- Stats -->
        <div class="profile-stats">
          <div class="stat-item">
            <strong>{{ posts?.length || 0 }}</strong>
            <span>Posts</span>
          </div>
          <div class="stat-item">
            <strong>{{ followers || 0 }}</strong>
            <span>Followers</span>
          </div>
          <div class="stat-item">
            <strong>{{ followings || 0 }}</strong>
            <span>Following</span>
          </div>
        </div>

        <!-- Meta Info -->
        <div class="profile-meta" *ngIf="user.email">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M14 6.667l-6 4-6-4M2.667 3.333h10.666c.737 0 1.334.597 1.334 1.334v6.666c0 .737-.597 1.334-1.334 1.334H2.667a1.333 1.333 0 01-1.334-1.334V4.667c0-.737.597-1.334 1.334-1.334z"
              stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
          <span>{{ user.email }}</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Posts Section -->
  <section class="posts-section">
    <div class="section-header">
      <h2>Posts</h2>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="!posts || posts.length === 0">
      <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M32 8v48M8 32h48" stroke="#ccc" stroke-width="4" stroke-linecap="round" />
        <circle cx="32" cy="32" r="28" stroke="#ccc" stroke-width="4" />
      </svg>
      <p>No posts yet.</p>
    </div>

    <!-- Posts Grid -->
    <div class="posts-grid" *ngIf="posts && posts.length > 0">
      <article class="post-card" *ngFor="let post of posts">
        <!-- Post Header -->
        <header class="post-header">
          <div class="post-author">
            <img class="author-avatar" [src]="'assets/icons/pngtree-outline-user-icon-png-image_5045523.jpg'"
              alt="author">
            <div class="author-info">
              <strong>{{ post.user.username }}</strong>
              <span class="post-time">{{ post.createdAt | date:'short' }}</span>
            </div>
          </div>

          <!-- Delete Button -->
          <button class="delete-btn" *ngIf="post.user.username === me?.username || me?.role === 'Admin'"
            (click)="CheckDeletePost(post.id)">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M2.5 5h15M8.333 9.167v5M11.667 9.167v5M3.333 5l.834 11.667c0 .916.75 1.666 1.666 1.666h8.334c.916 0 1.666-.75 1.666-1.666L16.667 5M7.5 5V3.333c0-.916.75-1.666 1.667-1.666h1.666c.917 0 1.667.75 1.667 1.666V5"
                stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </button>
        </header>

        <!-- Media -->
        <div class="post-media-wrapper" *ngIf="!post.mediaUrl?.endsWith('null')">
          <ng-container [ngSwitch]="post.mediaUrl ? post.mediaUrl.split('.').pop()?.toLowerCase() : ''">
            <img *ngSwitchCase="'jpg'" [src]="post.mediaUrl" alt="Post image" class="post-media-img">
            <img *ngSwitchCase="'jpeg'" [src]="post.mediaUrl" alt="Post image" class="post-media-img">
            <img *ngSwitchCase="'png'" [src]="post.mediaUrl" alt="Post image" class="post-media-img">
            <img *ngSwitchCase="'webp'" [src]="post.mediaUrl" alt="Post image" class="post-media-img">
            <video *ngSwitchCase="'mp4'" [src]="post.mediaUrl" controls class="post-media-video"
              preload="metadata"></video>
          </ng-container>
        </div>

        <!-- Post Content -->
        <div class="post-content">
          <p class="post-description">{{ post.description }}</p>

          <!-- Post Footer -->
          <div class="post-footer">
            <button class="reaction-btn">
              ‚ù§Ô∏è {{ post.likeCount || 0 }}
            </button>
            <button class="reaction-btn">
              üí¨ {{ post.commentsCount || 0 }}
            </button>
          </div>
        </div>
      </article>
    </div>
  </section>

  <!-- Popup Message
  <div class="popup-overlay" *ngIf="showPopup">
    <div class="popup-modal">
      <div class="popup-header">
        <h3>{{ popupMessage }}</h3>
      </div>
      <div class="popup-actions">
        <button class="action-btn primary-btn" (click)="closePopup()">Close</button>
      </div>
    </div>
  </div> -->

  <!-- Confirmation Modal -->
  <!-- <div class="popup-overlay" *ngIf="showConfirmation">
    <div class="modal-overlay" (click)="CancelAction()">
     <app-confirmation
      *ngIf="showConfirmation"
      [title]="confirmationTitle"
      [message]="confirmationMessage"
      [action]="confirmationAction"
      [params]="confirmationParams"
      (confirmed)="handleConfirmation($event)"
      (cancelled)="showConfirmation = false"
    ></app-confirmation>
    </div>
  </div> -->
  <div class="popup-overlay" *ngIf="showConfirmation" (click)="CancelAction()">
    <app-confirmation [title]="confirmationTitle" [message]="confirmationMessage" (confirmed)="HandleAction($event)">
    </app-confirmation>
  </div>
</div>