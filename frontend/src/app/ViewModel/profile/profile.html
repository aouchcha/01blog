<div class="profile-container">
  <!-- Profile Header Section -->
  <section class="profile-header-section">
    <div class="profile-header-content">
      <!-- Avatar -->
      <div class="avatar-wrapper">
        <img class="profile-avatar" [src]="'assets/icons/pngtree-outline-user-icon-png-image_5045523.jpg'" alt="Avatar">
      </div>

      <!-- Profile Info -->
      <div class="profile-info-wrapper">
        <div class="profile-top">
          <h1 class="profile-username">{{ user.username }}</h1>

          <!-- Action Buttons -->
          <div class="profile-actions">
            <!-- Follow/Unfollow Button -->
            <button class="action-btn primary-btn" *ngIf="user.username !== me.username && me.role !== 'Admin'"
              (click)="Follow()">
              {{ user.follow ? 'Unfollow' : 'Follow' }}
            </button>

            <!-- Home Button -->
            <button class="action-btn secondary-btn" *ngIf="me.role !== 'Admin'" (click)="Home()">
              Home
            </button>

            <!-- Dashboard Button (Admin) -->
            <button class="action-btn secondary-btn" *ngIf="me.role === 'Admin'" (click)="ToDashBoard()">
              To Dashboard
            </button>

            <!-- Report Button -->
            <button class="action-btn warning-btn" *ngIf="user.id != me.id && me.role !== 'Admin'"
              (click)="OpenReportSection()">
              Report
            </button>

            <!-- Remove User Button (Admin) -->
            <button class="action-btn danger-btn" *ngIf="me.role === 'Admin'" (click)="CheckBeforeRemoving()">
              Remove User
            </button>

            <button class="action-btn danger-btn" *ngIf="me.role === 'Admin' && !user.isbaned"
              (click)="CheckBeforeBan()">
              Ban
            </button>
            <button class="action-btn danger-btn" *ngIf="me.role === 'Admin' && user.isbaned"
              (click)="CheckBeforeUnBan()">
              UnBan
            </button>
          </div>
        </div>

        <!-- Report Section -->
        <div class="report-section" *ngIf="DoYouWantReport">
          <div class="report-card">
            <h3>Report User</h3>
            <div class="form-group">
              <textarea [(ngModel)]="description" required class="report-textarea"
                placeholder="Describe the issue..."></textarea>
            </div>
            <div class="report-actions">
              <button class="action-btn primary-btn" (click)="CheckReport()">
                Submit Report
              </button>
              <button class="action-btn secondary-btn" (click)="Cancel()">
                Cancel
              </button>
            </div>
          </div>
        </div>

        <!-- Stats -->
        <div class="profile-stats">
          <div class="stat-item">
            <strong>{{ postscount || 0 }}</strong>
            <span>Posts</span>
          </div>
          <div class="stat-item">
            <strong>{{ followers || 0 }}</strong>
            <span>Followers</span>
          </div>
          <div class="stat-item">
            <strong>{{ followings || 0 }}</strong>
            <span>Following</span>
          </div>
        </div>

        <!-- Meta Info -->
        <div class="profile-meta" *ngIf="user.email">
          <mat-icon>email</mat-icon>
          <span>{{ user.email }}</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Posts Section -->
  <section class="posts-section" (scroll)="handleScrollLogic($event)">
    <div class="section-header">
      <h2>Posts</h2>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="!posts || posts.length === 0">
      <p>No posts yet.</p>
    </div>

    <!-- Posts Grid -->
    <div class="posts-grid" *ngIf="posts && posts.length > 0">
      <article class="post-card" *ngFor="let post of posts">
        <!-- Post Header -->
        <header class="post-header">
          <div class="post-author">
            <img class="author-avatar" [src]="'assets/icons/pngtree-outline-user-icon-png-image_5045523.jpg'"
              alt="author">
            <div class="author-info">
              <strong>{{ post.user.username }}</strong>
              <span class="post-time">{{ post.createdAt | date:'short' }}</span>
            </div>
          </div>

          <!-- Delete Button -->
          <div class="postActions">
            <button class="delete-btn" *ngIf="post.user.username === me?.username || me?.role === 'Admin'"
              (click)="CheckDeletePost(post.id)">
              <mat-icon>delete</mat-icon>
            </button>
            <button class="hide-btn" *ngIf="me.role === 'Admin' && me.role === 'Admin' && !post.isHidden"
              (click)="CheckBeforeHide(post.id)">
              <mat-icon>visibility_off</mat-icon>
            </button>
            <button class="hide-btn" *ngIf="me.role === 'Admin' && me.role === 'Admin' && post.isHidden"
              (click)="CheckBeforeUnHide(post.id)">
              <mat-icon>visibility</mat-icon>
            </button>
          </div>
        </header>

        <!-- Media -->
        <div class="post-media-wrapper" *ngIf="!post.mediaUrl?.endsWith('null')">
          <ng-container [ngSwitch]="post.mediaUrl ? post.mediaUrl.split('.').pop()?.toLowerCase() : ''">
            <img *ngSwitchCase="'jpg'" [src]="post.mediaUrl" alt="Post image" class="post-media-img">
            <img *ngSwitchCase="'jpeg'" [src]="post.mediaUrl" alt="Post image" class="post-media-img">
            <img *ngSwitchCase="'png'" [src]="post.mediaUrl" alt="Post image" class="post-media-img">
            <img *ngSwitchCase="'webp'" [src]="post.mediaUrl" alt="Post image" class="post-media-img">
            <video *ngSwitchCase="'mp4'" [src]="post.mediaUrl" controls class="post-media-video"
              preload="metadata"></video>
          </ng-container>
        </div>

        <!-- Post Content -->
        <div class="post-content">
          <!-- <p class="post-description">{{ post.description }}</p> -->

          <!-- Post Footer -->
          <div class="post-footer" *ngIf="me.id === user.id || user.follow === true">
            <button class="reaction-btn" (click)="React(post.id)">
              <mat-icon>favorite</mat-icon> {{ post.likeCount || 0 }}
            </button>
            <button class="reaction-btn" (click)="ShowSinglePost(post.id)">
              <mat-icon>comment</mat-icon> {{ post.commentsCount || 0 }}
            </button>
            <button class="reaction-btn" *ngIf="post.user.username !== me?.username" (click)="OpenPostReportSection(post.id)">
              <mat-icon>report</mat-icon>
            </button>
          </div>
        </div>
      </article>
    </div>
  </section>

  <div class="popup-overlay" *ngIf="showConfirmation" (click)="CancelAction()">
    <app-confirmation [title]="confirmationTitle" [message]="confirmationMessage" (confirmed)="HandleAction($event)">
    </app-confirmation>
  </div>
  <div class="popup-overlay" *ngIf="DoYouWantReportPost">
    <div class="report-card">
      <h3>Report Post</h3>
      <div class="form-group">
        <textarea [(ngModel)]="Report_Description" required class="report-textarea"
          placeholder="Describe the issue..."></textarea>
      </div>
      <div class="report-actions">
        <button class="action-btn primary-btn" (click)="CheckBeforeReport()">
          Submit Report
        </button>
        <button class="action-btn secondary-btn" (click)="Cancel()">
          Cancel
        </button>
      </div>
    </div>
  </div>
</div>